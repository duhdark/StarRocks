# StarRocks Cluster Deployment

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è StarRocks –≤ –∫–ª–∞—Å—Ç–µ—Ä–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Docker Compose.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞

### Frontend (FE) —É–∑–ª—ã
- **starrocks-fe-1**: –ì–ª–∞–≤–Ω—ã–π FE —É–∑–µ–ª (Master)
- **starrocks-fe-2**: –í—Ç–æ—Ä–∏—á–Ω—ã–π FE —É–∑–µ–ª (Follower)
- **starrocks-fe-3**: –¢—Ä–µ—Ç–∏—á–Ω—ã–π FE —É–∑–µ–ª (Follower)

### Backend (BE) —É–∑–ª—ã
- **starrocks-be-1**: BE —É–∑–µ–ª 1
- **starrocks-be-2**: BE —É–∑–µ–ª 2
- **starrocks-be-3**: BE —É–∑–µ–ª 3

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∫–ª–∞—Å—Ç–µ—Ä–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

1. **–í—ã—Å–æ–∫–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å**: –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ —Å—Ç—Ä–æ—è —É–∑–ª–æ–≤
2. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –º–µ–∂–¥—É —É–∑–ª–∞–º–∏
3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
4. **–†–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ**: –†–µ–ø–ª–∏–∫–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —É–∑–ª–∞–º–∏

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ó–∞–ø—É—Å–∫ –∫–ª–∞—Å—Ç–µ—Ä–∞
```powershell
.\manage.ps1 start
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞
```powershell
.\manage.ps1 stop
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç—É—Å–∞
```powershell
.\manage.ps1 status
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
```powershell
.\manage.ps1 logs
```

## üîó –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∫–ª–∞—Å—Ç–µ—Ä—É

### –ß–µ—Ä–µ–∑ PowerShell —Å–∫—Ä–∏–ø—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```powershell
.\connect.ps1
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ PowerShell —Å–∫—Ä–∏–ø—Ç
```powershell
.\manage.ps1 start      # –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–ª–∞—Å—Ç–µ—Ä
.\manage.ps1 stop       # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–ª–∞—Å—Ç–µ—Ä
.\manage.ps1 restart    # –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–ª–∞—Å—Ç–µ—Ä
.\manage.ps1 status     # –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å
.\manage.ps1 logs       # –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏
.\manage.ps1 connect    # –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –∫–ª–∞—Å—Ç–µ—Ä—É
.\manage.ps1 clean      # –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
.\manage.ps1 help       # –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É
```

### –ß–µ—Ä–µ–∑ MySQL –∫–ª–∏–µ–Ω—Ç –Ω–∞–ø—Ä—è–º—É—é
```powershell
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ FE-1 (–æ—Å–Ω–æ–≤–Ω–æ–π —É–∑–µ–ª)
& "C:\Program Files\MySQL\MySQL Server 8.4\bin\mysql.exe" -h localhost -P 9030 -u root

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ FE-2 (—Ä–µ–ø–ª–∏–∫–∞)
& "C:\Program Files\MySQL\MySQL Server 8.4\bin\mysql.exe" -h localhost -P 9031 -u root

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ FE-3 (—Ä–µ–ø–ª–∏–∫–∞)
& "C:\Program Files\MySQL\MySQL Server 8.4\bin\mysql.exe" -h localhost -P 9032 -u root
```

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ FE —É–∑–ª–æ–≤
```sql
SHOW PROC '/frontends';
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ BE —É–∑–ª–æ–≤
```sql
SHOW PROC '/backends';
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏
```sql
SHOW PROC '/tablets';
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
starrocks-cluster/
‚îú‚îÄ‚îÄ docker-compose.yml    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∞
‚îú‚îÄ‚îÄ connect.ps1          # –°–∫—Ä–∏–ø—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
‚îú‚îÄ‚îÄ manage.ps1           # –°–∫—Ä–∏–ø—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
‚îú‚îÄ‚îÄ examples.sql         # –ü—Ä–∏–º–µ—Ä—ã SQL –∑–∞–ø—Ä–æ—Å–æ–≤
‚îú‚îÄ‚îÄ init-cluster.sql     # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∞
‚îî‚îÄ‚îÄ README.md            # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∞

### –ü–æ—Ä—Ç—ã
- **9030** - FE-1 (–æ—Å–Ω–æ–≤–Ω–æ–π —É–∑–µ–ª)
- **9031** - FE-2 (—Ä–µ–ø–ª–∏–∫–∞)
- **9032** - FE-3 (—Ä–µ–ø–ª–∏–∫–∞)
- **9060-9062** - BE —É–∑–ª—ã
- **9010-9012** - Edit log –ø–æ—Ä—Ç—ã
- **9020-9022** - RPC –ø–æ—Ä—Ç—ã

### –û–±—ä–µ–º—ã –¥–∞–Ω–Ω—ã—Ö
- `fe-1-data`, `fe-2-data`, `fe-3-data` - –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ FE
- `fe-1-log`, `fe-2-log`, `fe-3-log` - –ª–æ–≥–∏ FE
- `be-1-data`, `be-2-data`, `be-3-data` - –¥–∞–Ω–Ω—ã–µ BE
- `be-1-log`, `be-2-log`, `be-3-log` - –ª–æ–≥–∏ BE

## üõ†Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–æ–º

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —É–∑–ª–æ–≤

```powershell
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
.\manage.ps1 status

# –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
docker network ls
docker network inspect starrocks-cluster_starrocks-network
```

### –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ BE —É–∑–ª–∞
docker-compose up -d starrocks-be-4

# –£–¥–∞–ª–µ–Ω–∏–µ BE —É–∑–ª–∞
docker-compose stop starrocks-be-3
docker-compose rm starrocks-be-3
```

### –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö FE
docker exec starrocks-fe-1 /opt/starrocks/fe/bin/meta_tool --operation=backup --meta_dir=/opt/starrocks/fe/meta --backup_dir=/tmp/backup

# –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ –¥–∞–Ω–Ω—ã—Ö BE
docker exec starrocks-be-1 /opt/starrocks/be/bin/br_tool --operation=backup --storage_dir=/opt/starrocks/be/storage --backup_dir=/tmp/backup
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–æ—Ä—Ç—ã

#### Frontend —É–∑–ª—ã
- **FE-1**: 9030 (HTTP), 9010 (Edit log), 9020 (RPC)
- **FE-2**: 9031 (HTTP), 9011 (Edit log), 9021 (RPC)
- **FE-3**: 9032 (HTTP), 9012 (Edit log), 9022 (RPC)

#### Backend —É–∑–ª—ã
- **BE-1**: 9060 (HTTP), 8040 (BE), 8060 (BRPC), 9050 (Heartbeat)
- **BE-2**: 9061 (HTTP), 8041 (BE), 8061 (BRPC), 9051 (Heartbeat)
- **BE-3**: 9062 (HTTP), 8042 (BE), 8062 (BRPC), 9052 (Heartbeat)

### –¢–æ–º–∞ –¥–∞–Ω–Ω—ã—Ö

–ö–∞–∂–¥—ã–π —É–∑–µ–ª –∏–º–µ–µ—Ç —Å–≤–æ–∏ —Ç–æ–º–∞ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –∏ –ª–æ–≥–æ–≤:
- `fe-1-data`, `fe-2-data`, `fe-3-data`: –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ FE —É–∑–ª–æ–≤
- `fe-1-log`, `fe-2-log`, `fe-3-log`: –õ–æ–≥–∏ FE —É–∑–ª–æ–≤
- `be-1-data`, `be-2-data`, `be-3-data`: –î–∞–Ω–Ω—ã–µ BE —É–∑–ª–æ–≤
- `be-1-log`, `be-2-log`, `be-3-log`: –õ–æ–≥–∏ BE —É–∑–ª–æ–≤

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–µ–π

```sql
CREATE DATABASE cluster_test;
USE cluster_test;

CREATE TABLE distributed_table (
    id INT,
    name VARCHAR(50),
    value DECIMAL(10,2),
    created_at DATETIME
) DUPLICATE KEY(id)
DISTRIBUTED BY HASH(id) BUCKETS 6
PROPERTIES("replication_num" = "3");
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü –ø–æ —É–∑–ª–∞–º
SHOW PROC '/tablets'\G

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏
SHOW PROC '/tablets'\G

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —É–∑–ª—ã
SHOW PROC '/backends'\G
```

### –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã

```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
INSERT INTO distributed_table VALUES 
(1, 'item1', 100.50, NOW()),
(2, 'item2', 200.75, NOW()),
(3, 'item3', 150.25, NOW());

-- –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—Ä–æ—Å —Å –∞–≥—Ä–µ–≥–∞—Ü–∏–µ–π
SELECT 
    DATE(created_at) as date,
    COUNT(*) as total_items,
    SUM(value) as total_value,
    AVG(value) as avg_value
FROM distributed_table
GROUP BY DATE(created_at)
ORDER BY date;
```

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–ø—É—Å–∫–æ–º

1. **FE —É–∑–ª—ã –Ω–µ –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ `docker-compose logs starrocks-fe-2`
2. **BE —É–∑–ª—ã –Ω–µ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ FE —É–∑–ª—ã –∑–∞–ø—É—â–µ–Ω—ã
3. **–ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Docker network

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —É–∑–ª–∞
docker-compose logs starrocks-fe-1

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
docker exec -it starrocks-fe-1 bash

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
docker exec starrocks-fe-1 cat /opt/starrocks/fe/conf/fe.conf
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–±–æ—è

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —É–∑–ª–∞
docker-compose restart starrocks-fe-2

# –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞
docker-compose down
docker-compose up -d

# –û—á–∏—Å—Ç–∫–∞ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
docker-compose down -v
docker system prune -f
docker-compose up -d
```

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Docker 20.10+
- Docker Compose 2.0+
- –ú–∏–Ω–∏–º—É–º 8GB RAM
- 20GB —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ
- –ú–∏–Ω–∏–º—É–º 4 CPU —è–¥—Ä–∞

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

1. **–°—Ç–∞—Ç—É—Å —É–∑–ª–æ–≤**: –í—Å–µ FE –∏ BE —É–∑–ª—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ —Å—Ç–∞—Ç—É—Å–µ "Alive"
2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤**: CPU, Memory, Disk I/O
3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: Query latency, Throughput
4. **–†–µ–ø–ª–∏–∫–∞—Ü–∏—è**: Status of tablet replicas

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–∞–º–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

StarRocks –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Prometheus –Ω–∞ –ø–æ—Ä—Ç–∞—Ö:
- FE: `/metrics` endpoint –Ω–∞ HTTP –ø–æ—Ä—Ç—É
- BE: `/metrics` endpoint –Ω–∞ HTTP –ø–æ—Ä—Ç—É 